{"version":3,"names":["tSourceRefCss","TSourceRefStyle0","TSourceRef","getSourceId","customElements","whenDefined","_a","this","sourceId","element","getAttribute","tLink","shadowRoot","querySelector","tSource","render","article","closest","h","Host","key","slot","href","SOURCE_ID_PREFIX","source","sources","componentDidRender","getArticle","then","async","sourceOrder","getSourceOrder","sourceNumber","findUniqueIndex","sourceRefLink","innerText"],"sources":["src/components/t-source-ref/t-source-ref.css?tag=t-source-ref&encapsulation=shadow","src/components/t-source-ref/t-source-ref.tsx"],"sourcesContent":["sup {\n  font-size: smaller;\n  vertical-align: super;\n}\n","import { Component, Host, h, Prop, Element, Method } from '@stencil/core';\nimport { SOURCE_ID_PREFIX } from '../../constants';\nimport { findUniqueIndex } from '../../utils/arrayUtils';\n\n@Component({\n  tag: 't-source-ref',\n  styleUrl: 't-source-ref.css',\n  shadow: true,\n})\nexport class TSourceRef {\n\n  @Prop() sourceId: string;\n\n  @Element() element: HTMLElement;\n\n  @Method() async getSourceId() {\n    await customElements.whenDefined('t-source-ref');\n    return this.sourceId ?? this.element.getAttribute('sourceid');\n  }\n\n  get tLink(): HTMLTLinkElement {\n    return this.element.shadowRoot.querySelector('t-link');\n  }\n\n  get tSource(): HTMLTSourceElement {\n    return this.element.shadowRoot.querySelector('t-source');\n  }\n\n  render() {\n    const article: HTMLTArticleElement = this.element.closest('t-article');\n\n    return (\n      <Host>\n        <t-tooltip>\n          <sup slot=\"trigger\">\n            <t-link href={`#${SOURCE_ID_PREFIX}${this.sourceId}`}/>\n          </sup>\n          <t-source\n            slot=\"content\"\n            source={article.sources[this.sourceId]}\n          />\n        </t-tooltip>\n      </Host>\n    );\n  }\n\n  componentDidRender() {\n    this.getArticle().then(async article => {\n      const sourceOrder = await article.getSourceOrder();\n      const sourceId = await this.getSourceId();\n      const sourceNumber = findUniqueIndex(sourceOrder, sourceId) + 1;\n      const tSource: HTMLTSourceElement = this.tSource;\n      tSource.source = article.sources[sourceId];\n      const sourceRefLink: HTMLTLinkElement = this.tLink;\n      sourceRefLink.innerText = `[${sourceNumber}]`;\n      sourceRefLink.href = `#${SOURCE_ID_PREFIX}${sourceId}`;\n    });\n  }\n\n  private async getArticle(): Promise<HTMLTArticleElement> {\n    await customElements.whenDefined('t-article');\n    return this.element.closest('t-article');\n  }\n}\n"],"mappings":"iIAAA,MAAMA,EAAgB,8CACtB,MAAAC,EAAeD,E,MCQFE,EAAU,M,iDAMX,iBAAMC,G,YACRC,eAAeC,YAAY,gBACjC,OAAOC,EAAAC,KAAKC,YAAQ,MAAAF,SAAA,EAAAA,EAAIC,KAAKE,QAAQC,aAAa,W,CAGpD,SAAIC,GACF,OAAOJ,KAAKE,QAAQG,WAAWC,cAAc,S,CAG/C,WAAIC,GACF,OAAOP,KAAKE,QAAQG,WAAWC,cAAc,W,CAG/C,MAAAE,GACE,MAAMC,EAA+BT,KAAKE,QAAQQ,QAAQ,aAE1D,OACEC,EAACC,EAAI,CAAAC,IAAA,4CACHF,EAAA,aAAAE,IAAA,4CACEF,EAAA,OAAAE,IAAA,2CAAKC,KAAK,WACRH,EAAA,UAAAE,IAAA,2CAAQE,KAAM,IAAIC,IAAmBhB,KAAKC,cAE5CU,EAAA,YAAAE,IAAA,2CACEC,KAAK,UACLG,OAAQR,EAAQS,QAAQlB,KAAKC,a,CAOvC,kBAAAkB,GACEnB,KAAKoB,aAAaC,MAAKC,MAAMb,IAC3B,MAAMc,QAAoBd,EAAQe,iBAClC,MAAMvB,QAAiBD,KAAKJ,cAC5B,MAAM6B,EAAeC,EAAgBH,EAAatB,GAAY,EAC9D,MAAMM,EAA8BP,KAAKO,QACzCA,EAAQU,OAASR,EAAQS,QAAQjB,GACjC,MAAM0B,EAAkC3B,KAAKI,MAC7CuB,EAAcC,UAAY,IAAIH,KAC9BE,EAAcZ,KAAO,IAAIC,IAAmBf,GAAU,G,CAIlD,gBAAMmB,SACNvB,eAAeC,YAAY,aACjC,OAAOE,KAAKE,QAAQQ,QAAQ,Y"}